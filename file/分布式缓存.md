# 分布式缓存：

## A.主从副本模式分布式集群：

### 模型：
![主从模型图](https://github.com/btlyh/serverTechnology/blob/main/img/ms.png "简单模型")  

主从模式其实就是一个master节点和N个slave节点组成的分布式缓存集群，每一个缓存节点  
上的数据都是一致的、相同的。

### 优点：
1.实现读写分离，数据从master写入并备份至slave  

2.HA，高可用性，当某个节点故障宕机数据不会丢失

### 缺点：
1.占用大量资源，无法解决资源分摊的问题

***

## B.切片（cluster）模式分布式集群：
传统的切片集群，是把数据通过算法映射至对应的某个节点，虽然数据可以相对的分摊到各个  
节点，但没有办法解决集群节点扩展或删减时暴露的问题。  

当节点进行扩展或删减时，由于需要做数据迁移而导致大量的IO操作，导致性能下降和资源的  
浪费。

因此，可以用hash环模型的切片分布式集群来解决集群节点的扩展或删减时暴露的问题。

### 模型：
![切片模型图](https://github.com/btlyh/serverTechnology/blob/main/img/cluster.png "简单模型")

### 数据写入：
每当数据要写入时，首先对当前数据做hash算法得到hash值，然后使用得到的hash值在hash  

环上顺时针找到第一个集群节点，最后将数据写入。

### 节点扩展和删减
1.当集群节点需要进行扩展的时候，计算出当前节点的hash值，并在环上顺时针找到第一个集群  
节点，然后将找到的节点数据平均迁移到新增节点上。  

2.当集群节点需要进行删减的时候，计算出当前节点的hash值，并在环上顺时针找到第一个集群  
节点，然后将要删减的节点上的数据全部迁移至找到的节点上。  

这样无论是新增或者删减节点，永远是两个结点间的数据IO交换，对于其他不相干的节点是无感  
的，从而保证了集群节点扩展和删减时的平滑性。  

### 优点：
1.保证了海量数据的缓存，将所有数据分布至各个节点来保证单机不会出现资源和性能  
等问题

2.高扩展性，节点可随时扩展或删减，不会引起性能问题

### 缺点：
暂时没觉得这个架构有什么问题=。=

### tips：
1.为了防止数据倾斜的问题，可以将一个节点实例映射成多个虚拟节点分布在hash环上  

2.各个节点也可以做主从备份来保证HA高可用。  

## C.缓存穿透的问题解决：
再访问DB之前，添加一个**布隆算法**的过滤器，以减少访问DB的次数。  

ps:**布隆过滤器的bit数组长度越大、hash函数个数越多、则错误率越低**
